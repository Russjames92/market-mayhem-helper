<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#0b0b0c" />
  <title>Market Mayhem Helper</title>

  <link rel="icon" href="my-favicon/favicon.ico">
  <link rel="icon" type="image/png" sizes="96x96" href="my-favicon/favicon-96x96.png">
  <link rel="icon" type="image/svg+xml" href="my-favicon/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="my-favicon/apple-touch-icon.png">
  <meta name="apple-mobile-web-app-title" content="MM Helper">
  <link rel="manifest" href="my-favicon/site.webmanifest">

  <link rel="stylesheet" href="styles.css" />
</head>

<body class="noPageScroll">
  <header class="appHeader">
    <div class="headerLeft">
      <div id="volatilityPill" class="headerPill volPill" hidden
           data-tooltip="Volatility Mode is active: high-risk stocks are added and trades can cause slippage.">
        Volatility Mode
      </div>

      <div id="liveAnnouncement" class="headerPill livePill" hidden>
        üíª SESSION IS LIVE üíª
      </div>
    </div>

    <div class="headerCenter">
      <div class="brandTitle">
        <div class="brandKicker">MARKET MAYHEM</div>
        <div class="brandMain">EXCHANGE</div>
      </div>

      <div class="headerMeta">
        <div class="pill" id="sessionStatus"
             data-tooltip="Shows whether a game is active and whether you are Host or Viewer.">
          No session loaded
        </div>
      </div>
    </div>

    <div class="headerRight">
      <button id="btnSettings" class="iconCircle" type="button" title="Settings" aria-label="Open settings">‚öôÔ∏è</button>
      <button id="btnUndo" class="iconCircle" type="button" title="Undo" aria-label="Undo last action">‚Ü©</button>
      <button id="btnEndSession" class="iconCircle dangerCircle" type="button" title="End game" aria-label="End game" disabled>‚úï</button>
    </div>
  </header>

  <div id="logTicker" class="logTicker" aria-live="polite" aria-atomic="true">
    <div class="logTickerInner">
      <span class="logTickerLabel">üî¥ News</span>
      <span id="logTickerText">‚Äî</span>
    </div>
  </div>

  <main class="appMain">
    <!-- LEFT COLUMN (Gallery) -->
    <aside class="leftRail">
      <div class="leftGallery" id="leftGallery" aria-label="Left panels">
        <!-- Slide 1: Setup -->
        <div class="gallerySlide" data-panel="setup">
          <section class="card" id="setupCard">
            <div class="sectionHead">
              <h2>Session Setup</h2>
              <button type="button" class="btnToggle" id="btnToggleSetup">Collapse</button>
            </div>

            <div class="sub">
              Choose number of players (2‚Äì4), names, and starting cash. Then start session.
            </div>

            <div id="setupBody">
              <div class="row">
                <button id="btnStartLive" class="btn"
                        data-tooltip="Start/End Live Session: host + viewers on Firebase.">
                  Start/End Live Session
                </button>
                <button id="btnNewGame" class="btn"
                        data-tooltip="Start New Game: local play setup.">
                  Start New Game
                </button>
              </div>

              <div class="mini muted">
                Live session is for Host + Viewers. Start new game is for local play setup.
              </div>

              <div class="divider"></div>

              <div class="row">
                <label class="field">
                  <span class="label">Players</span>
                  <select id="playerCount">
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                  </select>
                </label>

                <label class="field">
                  <span class="label">Starting Cash</span>
                  <input id="startingCash" type="number" value="1000000" step="1000" />
                </label>
              </div>

              <div id="playerNameFields" class="grid2"></div>

              <div class="row">
                <label class="check">
                  <input id="volatilityMode" type="checkbox" />
                  <span>Enable Volatility Mode</span>
                </label>
              </div>

              <div class="divider"></div>

              <div class="row">
                <button id="btnStartGame" class="btn primary"
                        data-tooltip="Create players + initialize stock prices and start the game.">
                  Start Game
                </button>
              </div>

              <div class="mini muted">
                Tip: Use the tabs on the right to switch between Players, Pit Board, Game Log, and Leaderboard.
              </div>
            </div>
          </section>
        </div>

        <!-- Slide 2: Market Mover -->
        <div class="gallerySlide" data-panel="mover">
          <section class="card" id="marketMoverCard">
            <div class="sectionHead">
              <h2>Market Mover</h2>
              <button type="button" class="btnToggle" id="btnToggleMover">Collapse</button>
            </div>

            <div class="sub">
              Select industries, choose up/down, then enter the 2d6 total.
            </div>

            <div id="moverBody">
              <label class="field">
                <span class="label">Dice total (2‚Äì12)</span>
                <select id="diceTotalSelect">
                  <option value="" selected>üé≤ Dice Total</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                </select>
              </label>

              <div class="industryGrid" id="industryGrid"></div>

              <div class="row">
                <button id="btnApplyMoverDown" class="btn"
                        data-tooltip="Apply selected industries DOWN using the chosen dice total.">
                  ‚àí Apply
                </button>
                <button id="btnClearMover" class="btn"
                        data-tooltip="Clear selected industries.">
                  Clear
                </button>
                <button id="btnApplyMoverUp" class="btn"
                        data-tooltip="Apply selected industries UP using the chosen dice total.">
                  + Apply
                </button>
              </div>
            </div>
          </section>
        </div>

        <!-- Slide 3: Quick Tools -->
        <div class="gallerySlide" data-panel="tools">
          <section class="card" id="toolsCard">
            <div class="sectionHead">
              <h2>Quick Tools</h2>
              <button type="button" class="btnToggle" id="btnToggleTools">Collapse</button>
            </div>
            <div class="sub">Common actions: dividends and short move.</div>

            <div id="toolsBody">
              <div class="row">
                <button class="danger" id="btnReset"
                        data-tooltip="Reset the current game back to setup. (Does not clear leaderboard.)">
                  Reset
                </button>

                <button id="btnPayDividends" disabled
                        data-tooltip="Pay dividends to all players based on current holdings.">
                  Pay Dividends
                </button>
              </div>

              <div class="row">
                <label class="field">
                  <span class="label">Short Move (¬±)</span>
                  <select id="shortMoveSelect">
                    <option value="" selected>Pick</option>
                    <option value="-1">‚àí1</option>
                    <option value="-2">‚àí2</option>
                    <option value="-3">‚àí3</option>
                    <option value="1">+1</option>
                    <option value="2">+2</option>
                    <option value="3">+3</option>
                  </select>
                </label>

                <button id="btnApplyShortMove" disabled
                        data-tooltip="Apply short move to the selected stock(s).">
                  Apply Short Move
                </button>
              </div>

              <div class="mini muted">
                Reset moved here to match the new header flow (Settings / Undo / End Game up top).
              </div>
            </div>
          </section>
        </div>
      </div>

      <div class="galleryDots" id="leftDots" aria-label="Left panel navigation">
        <button class="dot isActive" type="button" data-goto="setup" aria-label="Setup panel"></button>
        <button class="dot" type="button" data-goto="mover" aria-label="Market mover panel"></button>
        <button class="dot" type="button" data-goto="tools" aria-label="Quick tools panel"></button>
      </div>
    </aside>

    <!-- RIGHT COLUMN (Tabs + Scroll-in-panel content) -->
    <section class="mainRail">
      <div class="tabBar" role="tablist" aria-label="Main sections">
        <button class="tabBtn isActive" type="button" role="tab" data-tab="players" aria-selected="true">Players</button>
        <button class="tabBtn" type="button" role="tab" data-tab="pit" aria-selected="false">Pit Board</button>
        <button class="tabBtn" type="button" role="tab" data-tab="log" aria-selected="false">Game Log</button>
        <button class="tabBtn" type="button" role="tab" data-tab="leaderboard" aria-selected="false">Leaderboard</button>
      </div>

      <div class="tabViewport">
        <!-- Players Tab -->
        <section class="tabPanel isActive" data-tab="players" role="tabpanel">
          <section class="card" id="playersCard">
            <div class="sectionHead">
              <h2>Players</h2>
              <button type="button" class="btnToggle" id="btnTogglePlayers">Collapse</button>
            </div>
            <div class="sub">Buy/Sell in 100-share increments</div>

            <div id="playersBody">
              <div id="playerPills" class="pills"></div>
              <div id="playerCards"></div>
            </div>
          </section>
        </section>

        <!-- Pit Board Tab -->
        <section class="tabPanel" data-tab="pit" role="tabpanel">
          <section class="card" id="pitBoardSection">
            <div class="sectionHead">
              <h2>Pit Board</h2>
              <button type="button" class="btnToggle" id="btnTogglePit">Collapse</button>
            </div>
            <div class="sub">Desktop shows table. Mobile uses expandable card view.</div>

            <div id="pitBody">
              <div class="pitControls">
                <label class="field">
                  <span class="label">Filter</span>
                  <select id="pitFilterIndustry"></select>
                </label>

                <label class="field">
                  <span class="label">Sort</span>
                  <select id="pitSort"></select>
                </label>

                <div class="selectedInfo">
                  <div class="mini muted">Selected</div>
                  <div id="pitSelectedCount" class="mono">0</div>
                </div>

                <div class="applyRow">
                  <button id="btnBulkDown" class="btn">‚àí Apply</button>
                  <input id="bulkAmount" type="number" value="1" min="1" max="12" />
                  <button id="btnBulkUp" class="btn">+ Apply</button>
                </div>

                <button id="btnClearSelected" class="btn">Clear</button>
              </div>

              <div id="pitBoard"></div>
            </div>
          </section>
        </section>

        <!-- Game Log Tab -->
        <section class="tabPanel" data-tab="log" role="tabpanel">
          <section class="card" id="logCard">
            <div class="sectionHead">
              <h2>Game Log</h2>
              <button type="button" class="btnToggle" id="btnToggleLog">Collapse</button>
            </div>
            <div id="logBody">
              <div id="gameLog" class="log"></div>
            </div>
          </section>
        </section>

        <!-- Leaderboard Tab -->
        <section class="tabPanel" data-tab="leaderboard" role="tabpanel">
          <section class="card" id="leaderboardCard">
            <div class="sectionHead">
              <h2>Leaderboard</h2>
              <button type="button" class="btnToggle" id="btnToggleLeaderboard">Collapse</button>
            </div>

            <div id="leaderboardBody">
              <div class="row">
                <button id="btnShowRecent" class="btn">Recent Games</button>
                <button id="btnShowAllTime" class="btn">All-Time</button>
              </div>

              <div id="leaderboardView"></div>
            </div>
          </section>
        </section>
      </div>
    </section>
  </main>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modalOverlay" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <button id="settingsClose" class="modalClose" type="button" aria-label="Close settings">√ó</button>
      <h2 id="settingsTitle">Settings</h2>

      <div class="modalGrid">
        <div class="modalSection">
          <div class="sectionLabel">Audio</div>
          <label class="check">
            <input id="musicEnabled" type="checkbox" />
            <span>Enable background music</span>
          </label>
          <label class="field">
            <span class="label">Volume</span>
            <input id="musicVolume" type="range" min="0" max="1" step="0.01" />
          </label>
        </div>

        <div class="modalSection">
          <div class="sectionLabel">Display</div>
          <label class="check">
            <input id="tooltipsEnabled" type="checkbox" />
            <span>Enable tooltips</span>
          </label>
        </div>
      </div>

      <div class="modalActions">
        <button id="settingsSave" class="btn primary" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- Trade Modal -->
  <div id="tradeModal" class="modalOverlay" hidden>
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="tradeTitle">
      <button id="tradeClose" class="modalClose" type="button" aria-label="Close trade">√ó</button>
      <h2 id="tradeTitle">Trade</h2>

      <div class="modalGrid">
        <div class="modalSection">
          <div class="sectionLabel">Player</div>
          <div id="tradePlayerName" class="big">‚Äî</div>
          <div id="tradePlayerCash" class="mini muted">‚Äî</div>
        </div>

        <div class="modalSection">
          <div class="sectionLabel">Stock</div>
          <div id="tradeStockName" class="big">‚Äî</div>
          <div id="tradeStockPrice" class="mini muted">‚Äî</div>
        </div>

        <div class="modalSection">
          <div class="sectionLabel">Shares</div>
          <div class="tradeRow">
            <button id="tradeMinus100" class="btn">-100</button>
            <div id="tradeSharesVal" class="big mono">100</div>
            <button id="tradePlus100" class="btn">+100</button>
            <button id="tradeMax" class="btn">MAX</button>
          </div>
        </div>

        <div class="modalSection">
          <div class="sectionLabel">Actions</div>
          <div class="row">
            <button id="tradeBuy" class="btn primary">Buy</button>
            <button id="tradeSell" class="btn">Sell</button>
            <button id="tradeSellAll" class="btn danger">Sell All</button>
          </div>
        </div>
      </div>

      <div class="modalActions">
        <div class="mini muted" id="tradeFooter">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- Firebase (Realtime sessions) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

  <script src="app.base.js"></script>
  <script src="app.live.js"></script>
  <script src="app.boot.js"></script>
</body>
</html>
