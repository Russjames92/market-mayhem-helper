<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#0b0b0c" />
  <title>Market Mayhem Helper</title>

  <link rel="icon" href="my-favicon/favicon.ico">
  <link rel="icon" type="image/png" sizes="96x96" href="my-favicon/favicon-96x96.png">
  <link rel="icon" type="image/svg+xml" href="my-favicon/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="my-favicon/apple-touch-icon.png">
  <link rel="manifest" href="my-favicon/site.webmanifest">

  <!-- External stylesheet -->
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header>
    <div>
      <h1>Market Mayhem: Exchange</h1>
      <div class="mini muted">Market Mayhem Board Game Enhancer & Asset Tracker + Volatility Expansion Play</div>
      <div id="volatilityPill" class="volPill" hidden
           data-tooltip="Volatility Mode is active: high-risk stocks are added and trades can cause slippage.">
        Volatility Mode
      </div>
    </div>

    <div class="header-actions">
      <div class="headerTopRow">
        <div class="pill" id="sessionStatus"
             data-tooltip="Shows whether a game is active and whether you are Host or Viewer.">
          No session loaded
        </div>
    
        <button id="btnSettings" class="iconBtn" type="button" title="Settings" aria-label="Open settings">
          ‚öôÔ∏è
        </button>
      </div>
    
      <button class="danger" id="btnReset"
              data-tooltip="Reset the current game back to setup. (Does not clear leaderboard.)">
        Reset
      </button>
    
      <button class="danger" id="btnEndSession" type="button" disabled
              data-tooltip="End the game and record results to the leaderboard.">
        End Game
      </button>
      <button id="btnUndo" class="btn">Undo</button>
    </div>
  </header>
  
  <div id="logTicker" class="logTicker" aria-live="polite" aria-atomic="true">
    <div class="logTickerInner">
      <span class="logTickerLabel">üî¥ News</span>
      <span id="logTickerText">‚Äî</span>
    </div>
  </div>
  
  <main>
    <div id="liveAnnouncement" class="live-announcement" hidden>
      üíª SESSION IS LIVE üíª
    </div>
    <!-- LEFT COLUMN -->
    <section>
      <!-- 1) Session Setup -->
      <section class="card" id="setupCard">
        <div class="sectionHead">
          <h2>Session Setup</h2>
          <button type="button" class="btnToggle" id="btnToggleSetup">Collapse</button>
        </div>
        <div class="sub">Choose number of players (2‚Äì4), names, and starting cash. Then start session.</div>

        <div id="sessionSetupBody">
          <div class="divider"></div>
        
          <div class="setupLaunch">
            <button class="primary" id="btnOpenLiveModal" type="button"
                    data-tooltip="Host a live session or join as a viewer using a code.">
              Start/End Live Session
            </button>
            
            <button class="primary" id="btnOpenNewGameModal" type="button"
                    data-tooltip="Start a local game: set players, cash, and optional Volatility Mode.">
              Start New Game
            </button>
          </div>
        
          <div class="mini muted" style="margin-top:10px;">
            Live session is for Host + Viewers. Start new game is for local play setup.
          </div>
        </div>
        
        <!-- ‚úÖ Live Session Modal -->
        <div class="mmModal" id="liveModal" hidden aria-hidden="true">
          <div class="mmModalOverlay" data-close-modal="liveModal"></div>
        
          <div class="mmModalCard" role="dialog" aria-modal="true" aria-labelledby="liveModalTitle">
            <div class="mmModalHead">
              <h3 id="liveModalTitle">Live Session (Host + Viewers)</h3>
              <button class="btnIcon" type="button" data-close-modal="liveModal" aria-label="Close">‚úï</button>
            </div>
        
            <div class="sub">
              Host creates a live session and shares the link/code so everyone can view the same game state in real time.
            </div>
        
            <div class="row">
              <div class="pill" id="liveRolePill">Live: OFF</div>
              <div class="pill" id="liveViewersPill">Viewers: ‚Äî</div>
            </div>
        
            <button class="primary" id="btnLiveCreate" type="button"
                    data-tooltip="Create a live session as Host. Only the Host can control the game.">
              Create Live Session (Host)
            </button>
            
            <input id="liveJoinCode" type="text" placeholder="ex: K7P4D2"
                   data-tooltip="Enter a join code to connect as a Viewer." />
            
            <button id="btnLiveJoin" type="button"
                    data-tooltip="Join a live session as a Viewer (read-only).">
              Join Live Session (Viewer)
            </button>
        
            <div class="row">
              <div style="flex:1; min-width:260px;">
                <label>Share link</label>
                <input id="liveShareLink" type="text" readonly value="" />
              </div>
              <button id="btnCopyLiveLink" type="button"
                      data-tooltip="Copy the live session share link to send to viewers.">
                Copy Link
              </button>
              
              <button class="danger" id="btnLiveLeave" type="button" disabled
                      data-tooltip="Leave the live session. (Host ends it; viewers disconnect.)">
                Leave Live
              </button>
            </div>
        
            <div class="mini muted" id="liveHint">
              Tip: Viewers should open the share link on their phone. Host controls all actions.
            </div>
          </div>
        </div>
        
        <!-- ‚úÖ New Game Modal -->
        <div class="mmModal" id="newGameModal" hidden aria-hidden="true">
          <div class="mmModalOverlay" data-close-modal="newGameModal"></div>
        
          <div class="mmModalCard" role="dialog" aria-modal="true" aria-labelledby="newGameModalTitle">
            <div class="mmModalHead">
              <h3 id="newGameModalTitle">Start New Game</h3>
              <button class="btnIcon" type="button" data-close-modal="newGameModal" aria-label="Close">‚úï</button>
            </div>
        
            <div class="sub">Choose number of players (2‚Äì4), names, and starting cash. Then start session.</div>
        
            <div class="row">
              <div>
                <label>Number of players</label>
                <select id="playerCount">
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                </select>
              </div>
        
              <div>
                <label>Starting cash per player (default)</label>
                <input id="startingCash" type="number" min="0" step="1000" value="50000" />
              </div>
        
              <div class="mode-toggle">
                <label class="toggle">
                  <input type="checkbox" id="volatilityMode">
                  <span class="slider"></span>
                  <span class="toggle-text">
                    <strong>Volatility Mode</strong>
                    <small>Adds 10 high-risk stocks</small>
                  </span>
                </label>
              
                <label class="toggle">
                  <input type="checkbox" id="monopolyMode">
                  <span class="slider"></span>
                  <span class="toggle-text">
                    <strong>Monopoly Mode</strong>
                    <small>Custom starting cash per player</small>
                  </span>
                </label>
              </div>
            </div>
        
            <div class="divider"></div>
            <div id="playerInputs" class="grid2"></div>
            <div class="divider"></div>
        
            <button class="primary" id="btnStart">Start New Game</button>
          </div>
        </div>
      </section>

      <!-- 2) Market Mover -->
      <section class="card" id="marketMoverCard">
        <div class="sectionHead">
          <h2>Market Mover</h2>
          <button type="button" class="btnToggle" id="btnToggleMarketMover">Collapse</button>
        </div>
        <div class="sub">Select industries, choose up/down, then enter the 2d6 total.</div>

        <div id="marketMoverBody">
          <div class="row">
            <div>
              <label>Dice total (2‚Äì12)</label>
              <select id="diceTotal">
                <option value="">üé≤ Dice Total</option>
                <option value="2">‚öÄ‚öÄ (2)</option>
                <option value="3">‚öÄ‚öÅ (3)</option>
                <option value="4">‚öÄ‚öÇ (4)</option>
                <option value="5">‚öÄ‚öÉ (5)</option>
                <option value="6">‚öÄ‚öÑ (6)</option>
                <option value="7">‚öÅ‚öÑ (7)</option>
                <option value="8">‚öÇ‚öÑ (8)</option>
                <option value="9">‚öÉ‚öÑ (9)</option>
                <option value="10">‚öÑ‚öÑ (10)</option>
                <option value="11">‚öÑ‚öÖ (11)</option>
                <option value="12">‚öÖ‚öÖ (12)</option>
              </select>
            </div>
          </div>

          <div class="divider"></div>
          <div class="industry-list" id="industryList"></div>

          <div class="divider"></div>
          <button class="primary" id="btnApplyMarketMover" disabled>Apply Market Mover</button>

          <div class="mini muted" id="marketMoverHint">Start a session first.</div>
        </div>
      </section>

      <!-- 3) Quick Tools -->
      <section class="card" id="toolsCard">
        <div class="sectionHead">
          <h2>Quick Tools</h2>
          <button type="button" class="btnToggle" id="btnToggleTools">Collapse</button>
        </div>
        <div class="sub">Common actions: dividends and short move.</div>

        <div id="toolsBody">
          <div class="row">
            <button id="btnPayDividends" disabled>Pay Dividends (Opening Bell)</button>
            <button id="btnShortMove" disabled>Short Sell / Short Squeeze (+/- 8)</button>
          </div>

          <div class="row">
            <div>
              <label>Short Move Stock</label>
              <select id="shortMoveSymbol"></select>
            </div>
            <div>
              <label>Direction</label>
              <select id="shortMoveDir">
                <option value="up">Up (+8)</option>
                <option value="down">Down (-8)</option>
              </select>
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- RIGHT COLUMN -->
    <section class="rightCol">
      <!-- Players -->
      <section class="card" id="playersCard">
        <div class="sectionHead">
          <h2>Players</h2>
          <button type="button" class="btnToggle" id="btnTogglePlayers">Collapse</button>
        </div>
        <div class="sub" style="flex:1; min-width:220px;">Buy/Sell in 100-share increments</div>

        <div id="playersBody">
          <div class="row" style="align-items:flex-start;">
            <div style="flex:0; min-width:180px;">
            </div>
          </div>

          <div id="playerTabs" class="playerTabs"></div>
          <div id="playersArea"></div>
        </div>
      </section>

      <!-- Pit Board -->
      <section class="card" id="pitBoardSection">
        <div class="sectionHead">
          <h2>Pit Board</h2>
          <div class="sectionHeadBtns">
            <button type="button" class="btn" id="btnCryptoMarket" hidden
                    data-tooltip="Open the separate Crypto Market board (Volatility Mode only).">
              Crypto Market
            </button>
            <button type="button" class="btn" id="btnHousingMarket" hidden
                    data-tooltip="Open the separate Housing Market board (Volatility Mode only).">
              Avg. Housing Market
            </button>
            <button type="button" class="btnToggle" id="btnTogglePitBoard">Collapse</button>
          </div>
        </div>
        <div class="sub">Desktop shows table. Mobile uses expandable card view.</div>

        <div id="pitBoardBody">

          <div class="pitControls">
            <select id="pitIndustryFilter"></select>

            <div class="pitBulkRow">
              <button id="pitBulkMinus">- Apply</button>
              <input id="pitBulkAmt" type="number" inputmode="numeric" min="1" step="1" value="5" />
              <button id="pitBulkPlus">+ Apply</button>
            </div>

            <button id="pitSortCur">Sort Current: Off</button>
            <button id="pitClearSelected">Clear</button>
            <div id="pitSelectedCount" class="mini muted">Selected: 0</div>
          </div>

          <div class="row" id="pitControlsRow" style="align-items:center; margin-top:10px;">
            <label class="mini muted" style="display:flex; align-items:center; gap:8px; width:auto;">
              <input type="checkbox" id="pitSelectAll" />
              Select all (filtered)
            </label>
          </div>

          <div id="pitTableWrap">
            <table id="pitTable">
              <thead>
                <tr>
                  <th class="selectCol"></th>
                  <th>Symbol</th>
                  <th>Company</th>
                  <th>Industries</th>
                  <th>Dividend</th>
                  <th>Start</th>
                  <th id="pitCurHeader" title="Sort by Current Price">Current</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div id="pitCards"></div>
        </div>
      </section>

      <!-- Game Log -->
      <section class="card" id="logCard">
        <div class="sectionHead">
          <h2>Game Log</h2>
          <button type="button" class="btnToggle" id="btnToggleLog">Collapse</button>
        </div>
        <div class="sub" style="flex:1; min-width:200px;">Every market move + trade is recorded here.</div>

        <div id="logBody">
          <div class="row" style="align-items:flex-start;">
            <div style="flex:0; min-width:180px;">
              <button class="primary" id="btnPrintLog" type="button">Print / Export Log</button>
            </div>
          </div>

          <div class="log" id="log"></div>
        </div>
      </section>

      <!-- Leaderboard -->
      <section class="card" id="leaderboardCard">
        <div class="sectionHead">
          <h2>Leaderboard</h2>
          <button type="button" class="btnToggle" id="btnToggleLeaderboard">Collapse</button>
        </div>
        <div class="sub" style="flex:1; min-width:220px;">All completed sessions recorded on this device.</div>

        <div id="leaderboardBody">
          <div class="row" style="align-items:flex-start;">
            <div style="flex:0; min-width:180px;">
              <button id="btnClearLeaderboard" type="button">Clear Leaderboard</button>
            </div>
          </div>

          <div class="row" style="align-items:flex-start; margin-bottom:10px;">
            <button class="primary" id="btnLeaderboardViewSummary" type="button">All-Time Rankings</button>
            <button id="btnLeaderboardViewGames" type="button">Recent Games</button>
          </div>

          <div id="leaderboard"></div>
        </div>
      </section>
    </section>
  </main>

  <div id="settingsModal" class="modalOverlay" hidden>
  <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <button id="settingsClose" class="modalClose" type="button" aria-label="Close settings">‚úï</button>

    <h2 id="settingsTitle" class="modalTitle">Settings</h2>

    <div class="settingsRow">
      <div class="settingsLabel">
        <div class="settingsName">Music</div>
        <div class="settingsHint">Background loop</div>
      </div>
      <button id="musicMuteBtn" class="pillBtn" type="button">Mute</button>
      <input id="musicVolume" class="slider" type="range" min="0" max="100" step="1" />
      <div id="musicVolumeVal" class="settingsVal">‚Äî</div>
    </div>

    <div class="settingsRow">
      <div class="settingsLabel">
        <div class="settingsName">Sound Effects</div>
        <div class="settingsHint">Clicks, trades, bell</div>
      </div>
      <button id="sfxMuteBtn" class="pillBtn" type="button">Mute</button>
      <input id="sfxVolume" class="slider" type="range" min="0" max="100" step="1" />
      <div id="sfxVolumeVal" class="settingsVal">‚Äî</div>
    </div>
  </div>
</div>


  <!-- Firebase (Realtime sessions) -->
  
  <!-- ‚úÖ Crypto Market Modal (Volatility Mode) -->
  <div class="mmModal" id="cryptoModal" hidden aria-hidden="true">
    <div class="mmModalOverlay" data-close-modal="cryptoModal"></div>

    <div class="mmModalCard" role="dialog" aria-modal="true" aria-labelledby="cryptoModalTitle">
      <div class="mmModalHead">
        <h3 id="cryptoModalTitle">Crypto Market</h3>
        <button class="btnIcon" type="button" data-close-modal="cryptoModal" aria-label="Close">‚úï</button>
      </div>

      <div class="sub">
        Volatility Mode only. Crypto prices swing wildly at every Opening Bell. No dividends on crypto.
      </div>

      <div class="divider"></div>

      <div id="cryptoTableWrap">
        <table id="cryptoTable">
          <thead>
            <tr>
              <th>Symbol</th>
              <th>Asset</th>
              <th>Current</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="cryptoCards"></div>
    </div>
  </div>

  <!-- ‚úÖ Housing Market Modal (Volatility Mode) -->
  <div class="mmModal" id="housingModal" hidden aria-hidden="true">
    <div class="mmModalOverlay" data-close-modal="housingModal"></div>

    <div class="mmModalCard" role="dialog" aria-modal="true" aria-labelledby="housingModalTitle">
      <div class="mmModalHead">
        <h3 id="housingModalTitle">Housing Market</h3>
        <button class="btnIcon" type="button" data-close-modal="housingModal" aria-label="Close">‚úï</button>
      </div>

      <div class="sub">
        Volatility Mode only. Average house price shifts at every Opening Bell. No dividends on housing.
      </div>

      <div class="divider"></div>

      <div class="housingTop">
        <div class="housingPriceLine">
          <div class="mini muted">Avg. Price</div>
          <div id="housingCurPrice" class="housingCurPrice">$325k</div>
        </div>
        <div id="housingLastMove" class="housingMovePill flat">‚Äî</div>
      </div>

      <div class="divider"></div>

      <div class="housingTrade">
        <div class="mmTradeRow">
          <div class="field" style="flex:1; min-width:220px;">
            <label>Player</label>
            <select id="housingPlayer"></select>
          </div>

          <div class="field" style="flex:1; min-width:220px;">
            <label>Units (houses)</label>
            <div class="mmTradeShares">
              <button type="button" id="housingMinus1">-1</button>
              <span id="housingUnits" class="mini">1</span>
              <button type="button" id="housingPlus1">+1</button>
              <button type="button" id="housingMax" class="secondary">MAX</button>
            </div>
          </div>
        </div>

        <div id="housingPreview" class="mmTradePreview mini muted"></div>

        <div class="mmTradeBtns">
          <button type="button" id="housingBuy" class="primary">Buy</button>
          <button type="button" id="housingSell">Sell</button>
          <button type="button" id="housingSellAll" class="danger">Sell All</button>
        </div>
      </div>
    </div>
  </div>

<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

  <script src="app.base.js"></script>
  <script src="app.live.js"></script>
  <script src="app.boot.js"></script>
</body>
</html>

